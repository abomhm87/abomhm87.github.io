<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>MAHERTV</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #FFD700;
      --secondary-color: #C0A020;
      --bg-color: #121212;
      --card-color: #1E1E1E;
      --text-color: #FFFFFF;
      --hover-color: #FFEEA8;
      --favorite-color: #FF4081;
      --nilesat-color: #4CAF50;
      --tod-color: #2196F3;
      --ssc-color: #FF5722;
      --bein-color: #9C27B0;
      --music-color: #E91E63;
      --error-color: #FF5252;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      margin: 0;
      background-color: var(--bg-color);
      color: var(--text-color);
      font-family: 'Tajawal', Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px 10px;
      min-height: 100vh;
    }

    /* مشغل الفيديو */
    .player-container {
      position: relative;
      width: 90%;
      max-width: 1200px;
      margin: 0 auto;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      border-radius: 15px;
      overflow: hidden;
      transition: all 0.3s ease;
      aspect-ratio: 16/9;
    }

    .player-container.expanded {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      width: 100%;
      height: 100%;
      max-width: none;
      z-index: 1000;
      border-radius: 0;
      margin: 0;
      aspect-ratio: auto;
    }

    video {
      width: 100%;
      height: 100%;
      display: block;
      background-color: #000;
      cursor: pointer;
    }

    .player-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: rgba(0, 0, 0, 0.7);
      z-index: 5;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .player-container:hover .player-overlay {
      opacity: 1;
    }

    .channel-info {
      position: absolute;
      top: 15px;
      right: 15px;
      background: rgba(0, 0, 0, 0.7);
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .quality-indicator {
      position: absolute;
      top: 15px;
      left: 15px;
      background: rgba(0, 0, 0, 0.7);
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 14px;
    }

    .controls {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
      padding: 15px 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 10;
    }

    .player-container:hover .controls {
      opacity: 1;
    }

    .control-group {
      display: flex;
      align-items: center;
      gap: 10px;
      position: relative;
    }

    .controls button {
      background: rgba(0, 0, 0, 0.7);
      border: 1px solid var(--primary-color);
      color: var(--primary-color);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s;
    }

    .controls button:hover {
      background: var(--primary-color);
      color: #000;
      transform: scale(1.1);
    }

    .time-controls {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 14px;
      flex-grow: 1;
      max-width: 50%;
    }

    .progress-bar {
      flex-grow: 1;
      height: 5px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 5px;
      cursor: pointer;
      position: relative;
    }

    .progress {
      height: 100%;
      background: var(--primary-color);
      border-radius: 5px;
      width: 0%;
    }

    .quality-menu {
      position: absolute;
      bottom: 50px;
      right: 0;
      background: rgba(30, 30, 30, 0.95);
      border: 1px solid var(--primary-color);
      padding: 10px 0;
      border-radius: 8px;
      display: none;
      min-width: 120px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
      z-index: 20;
    }

    .quality-menu button {
      display: block;
      background: none;
      border: none;
      color: var(--text-color);
      padding: 8px 20px;
      cursor: pointer;
      text-align: right;
      width: 100%;
      transition: all 0.2s;
      border-radius: 0;
      height: auto;
    }

    .quality-menu button:hover {
      background: rgba(255, 215, 0, 0.2);
      color: var(--primary-color);
    }

    .quality-menu button.active {
      color: var(--primary-color);
      font-weight: bold;
    }

    /* أقسام القنوات */
    .channel-tabs {
      display: flex;
      justify-content: center;
      margin: 30px auto;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 30px;
      padding: 5px;
      width: fit-content;
      max-width: 95%;
      overflow-x: auto;
    }

    .channel-tab {
      padding: 12px 25px;
      cursor: pointer;
      border-radius: 20px;
      transition: all 0.3s;
      font-weight: bold;
      white-space: nowrap;
      margin: 0 3px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .channel-tab.active {
      background: var(--primary-color);
      color: #000;
      box-shadow: 0 4px 8px rgba(255, 215, 0, 0.3);
    }

    .channel-tab:hover:not(.active) {
      background: rgba(255, 255, 255, 0.1);
    }

    .channel-tab.nilesat-tab { background-color: var(--nilesat-color); }
    .channel-tab.tod-tab { background-color: var(--tod-color); }
    .channel-tab.ssc-tab { background-color: var(--ssc-color); }
    .channel-tab.bein-tab { background-color: var(--bein-color); }
    .channel-tab.music-tab { background-color: var(--music-color); }

    .channel-content {
      display: none;
      width: 100%;
      max-width: 1200px;
    }

    .channel-content.active {
      display: block;
    }

    .channel-section {
      margin-top: 20px;
      text-align: center;
      padding: 0 10px;
    }

    .channel-section h2 {
      margin-bottom: 25px;
      font-size: 24px;
      position: relative;
      display: inline-block;
    }

    .nilesat-section h2 { color: var(--nilesat-color); }
    .tod-section h2 { color: var(--tod-color); }
    .ssc-section h2 { color: var(--ssc-color); }
    .bein-section h2 { color: var(--bein-color); }
    .music-section h2 { color: var(--music-color); }

    .channel-section h2::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 50px;
      height: 2px;
    }

    .nilesat-section h2::after { background: var(--nilesat-color); }
    .tod-section h2::after { background: var(--tod-color); }
    .ssc-section h2::after { background: var(--ssc-color); }
    .bein-section h2::after { background: var(--bein-color); }
    .music-section h2::after { background: var(--music-color); }

    .channel-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
      padding: 0 10px;
    }

    .channel-btn {
      background: var(--card-color);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: var(--text-color);
      padding: 15px 10px;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 80px;
      position: relative;
      overflow: hidden;
    }

    .nilesat-btn { border-left: 4px solid var(--nilesat-color); }
    .tod-btn { border-left: 4px solid var(--tod-color); }
    .ssc-btn { border-left: 4px solid var(--ssc-color); }
    .bein-btn { border-left: 4px solid var(--bein-color); }
    .music-btn { border-left: 4px solid var(--music-color); }

    .channel-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .channel-btn i {
      font-size: 24px;
      margin-bottom: 8px;
    }

    .nilesat-btn i { color: var(--nilesat-color); }
    .tod-btn i { color: var(--tod-color); }
    .ssc-btn i { color: var(--ssc-color); }
    .bein-btn i { color: var(--bein-color); }
    .music-btn i { color: var(--music-color); }

    .favorite-btn {
      position: absolute;
      top: 5px;
      left: 5px;
      background: none;
      border: none;
      color: var(--text-color);
      font-size: 18px;
      cursor: pointer;
      z-index: 1;
      transition: all 0.3s;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .favorite-btn:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .favorite-btn.active {
      color: var(--favorite-color);
      transform: scale(1.2);
    }

    /* مشغل الموسيقى */
    #musicPlayer {
      margin-top: 30px;
      width: 90%;
      max-width: 600px;
      border-radius: 10px;
      background: var(--card-color);
      border: 1px solid var(--music-color);
    }

    /* شاشة التحميل */
    .loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: var(--primary-color);
      font-size: 22px;
      display: none;
      z-index: 5;
    }

    .loading-spinner {
      border: 5px solid rgba(255, 215, 0, 0.3);
      border-top: 5px solid var(--primary-color);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    .error-message {
      color: var(--error-color);
      margin-top: 10px;
      text-align: center;
      max-width: 80%;
    }

    /* دليل البرامج */
    .program-guide {
      display: none;
      background: var(--card-color);
      border-radius: 10px;
      padding: 15px;
      margin-top: 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .program-guide.active {
      display: block;
    }

    .program-guide h3 {
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .program-item {
      padding: 10px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      justify-content: space-between;
    }

    .program-item:last-child {
      border-bottom: none;
    }

    .program-time {
      color: var(--primary-color);
      font-weight: bold;
      min-width: 60px;
    }

    /* رسومات متحركة */
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* تصميم متجاوب */
    @media (max-width: 768px) {
      .channel-buttons {
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      }
      
      .channel-btn {
        padding: 12px 8px;
        height: 70px;
        font-size: 14px;
      }
      
      .channel-tabs {
        padding: 3px;
        border-radius: 20px;
      }
      
      .channel-tab {
        padding: 8px 15px;
        font-size: 14px;
      }
      
      .time-controls {
        font-size: 12px;
      }
      
      .controls button {
        width: 35px;
        height: 35px;
        font-size: 14px;
      }
    }

    @media (min-width: 1920px) {
      body {
        font-size: 18px;
      }
      
      .channel-btn {
        padding: 20px 15px;
        height: 100px;
        font-size: 18px;
      }
      
      .channel-btn i {
        font-size: 30px;
      }
    }
  </style>
</head>
<body>
  <!-- مشغل الفيديو -->
  <div class="player-container" id="playerContainer">
    <video id="video" autoplay></video>
    
    <div class="player-overlay">
      <div class="channel-info" id="channelInfo">
        <i class="fas fa-tv"></i>
        <span id="channelName">اختر قناة</span>
      </div>
      <div class="quality-indicator" id="qualityIndicator">
        جودة: تلقائي
      </div>
    </div>
    
    <div class="loading-overlay" id="loadingOverlay">
      <div class="loading-spinner"></div>
      <span>جارٍ التحميل...</span>
      <div class="error-message" id="errorMessage"></div>
    </div>

    <div class="controls" id="controls">
      <div class="control-group">
        <button onclick="togglePlay()"><i class="fas fa-play" id="playIcon"></i></button>
        <button onclick="stopVideo()"><i class="fas fa-stop"></i></button>
        <button onclick="toggleMute()"><i class="fas fa-volume-up" id="volumeIcon"></i></button>
      </div>
      
      <div class="time-controls">
        <span id="currentTime">00:00</span>
        <div class="progress-bar" onclick="seek(event)">
          <div class="progress" id="progress"></div>
        </div>
        <span id="duration">00:00</span>
      </div>
      
      <div class="control-group">
        <button onclick="toggleFullscreen()"><i class="fas fa-expand"></i></button>
        <button id="qualityBtn" onclick="toggleQualityMenu(event)"><i class="fas fa-cog"></i></button>
        <div class="quality-menu" id="qualityMenu">
          <button onclick="changeQuality('auto')">تلقائي</button>
          <button onclick="changeQuality('240p')">240p</button>
          <button onclick="changeQuality('360p')">360p</button>
          <button onclick="changeQuality('720p')">720p</button>
          <button onclick="changeQuality('1080p')">1080p</button>
        </div>
      </div>
    </div>
  </div>

  <!-- أقسام القنوات -->
  <div class="channel-tabs">
    <div class="channel-tab" onclick="showChannelTab('favorites')"><i class="fas fa-heart"></i> المفضلة</div>
    <div class="channel-tab active nilesat-tab" onclick="showChannelTab('nilesat')"><i class="fas fa-satellite"></i> Nilesat</div>
    <div class="channel-tab tod-tab" onclick="showChannelTab('tod')"><i class="fas fa-tv"></i> TOD SPORTS</div>
    <div class="channel-tab ssc-tab" onclick="showChannelTab('ssc')"><i class="fas fa-trophy"></i> SSC SPORTS</div>
    <div class="channel-tab bein-tab" onclick="showChannelTab('bein')"><i class="fas fa-futbol"></i> Bein Sports</div>
    <div class="channel-tab music-tab" onclick="showChannelTab('music')"><i class="fas fa-music"></i> موسيقى</div>
  </div>

  <!-- قسم المفضلة -->
  <div class="channel-content" id="favorites-content">
    <div class="channel-section">
      <h2 style="color: var(--favorite-color);"><i class="fas fa-heart"></i> قنواتي المفضلة</h2>
      <div class="channel-buttons" id="favorites-channels">
        <!-- سيتم ملؤها بواسطة الجافاسكريبت -->
      </div>
    </div>
  </div>

  <!-- قسم Nilesat -->
  <div class="channel-content active nilesat-section" id="nilesat-content">
    <div class="channel-section">
      <h2><i class="fas fa-satellite"></i>شاهد + عراقيه + اسلاميه </h2>
      <div class="channel-buttons" id="nilesat-channels">
        <!-- سيتم ملؤها بواسطة الجافاسكريبت -->
      </div>
    </div>
    <div class="program-guide" id="nilesat-program-guide">
      <h3><i class="fas fa-tv"></i> دليل برامج القناة</h3>
      <div id="nilesat-program-list"></div>
    </div>
  </div>

  <!-- قسم TOD SPORTS -->
  <div class="channel-content tod-section" id="tod-content">
    <div class="channel-section">
      <h2><i class="fas fa-tv"></i> قنوات TOD SPORTS</h2>
      <div class="channel-buttons" id="tod-channels">
        <!-- سيتم ملؤها بواسطة الجافاسكريبت -->
      </div>
    </div>
  </div>

  <!-- قسم SSC SPORTS -->
  <div class="channel-content ssc-section" id="ssc-content">
    <div class="channel-section">
      <h2><i class="fas fa-trophy"></i> قنوات SSC SPORTS</h2>
      <div class="channel-buttons" id="ssc-channels">
        <!-- سيتم ملؤها بواسطة الجافاسكريبت -->
      </div>
    </div>
  </div>

  <!-- قسم Bein Sports -->
  <div class="channel-content bein-section" id="bein-content">
    <div class="channel-section">
      <h2><i class="fas fa-futbol"></i> قنوات Bein Sports</h2>
      <div class="channel-buttons" id="bein-channels">
        <!-- سيتم ملؤها بواسطة الجافاسكريبت -->
      </div>
    </div>
  </div>

  <!-- قسم الموسيقى -->
  <div class="channel-content music-section" id="music-content">
    <div class="channel-section">
      <h2><i class="fas fa-music"></i> راديو قنوات Bein Sports</h2>
      <div class="channel-buttons" id="music-channels">
        <!-- سيتم ملؤها بواسطة الجافاسكريبت -->
      </div>
    </div>
    <audio id="musicPlayer" controls></audio>
    <div class="program-guide" id="music-program-guide">
      <h3><i class="fas fa-info-circle"></i> معلومات القناة</h3>
      <div id="music-program-list"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
    // ========== العناصر الأساسية ========== //
    const video = document.getElementById("video");
    const playIcon = document.getElementById("playIcon");
    const volumeIcon = document.getElementById("volumeIcon");
    const qualityMenu = document.getElementById("qualityMenu");
    const qualityBtn = document.getElementById("qualityBtn");
    const musicPlayer = document.getElementById("musicPlayer");
    const loadingOverlay = document.getElementById("loadingOverlay");
    const errorMessage = document.getElementById("errorMessage");
    const progress = document.getElementById("progress");
    const currentTimeDisplay = document.getElementById("currentTime");
    const durationDisplay = document.getElementById("duration");
    const playerContainer = document.getElementById("playerContainer");
    const channelName = document.getElementById("channelName");
    const qualityIndicator = document.getElementById("qualityIndicator");

    let hls;
    let isSeeking = false;
    let currentQuality = 'auto';
    let currentChannel = null;
    let isExpanded = false;
    let retryCount = 0;
    const MAX_RETRIES = 3;
    
    // ========== بيانات القنوات ========== //
    const channels = {
      nilesat: [
        // === القنوات الترفيهية المضافة أولاً ===
        { id: 1, name: "باب الحارة", logo: "fas fa-video", url: "https://shls-live-enc.edgenextcdn.net/out/v1/948c54279b594944adde578c95f1d7d1/index_4.m3u8", programs: [] },
        { id: 2, name: "ناصر القصبي", logo: "fas fa-user", url: "https://shls-live-enc.edgenextcdn.net/out/v1/20e003242d244710bfe9ca0fd2b94d00/index_1.m3u8", programs: [] },
        { id: 3, name: "أفلام MBC", logo: "fas fa-film", url: "https://shls-live-enc.edgenextcdn.net/out/v1/46079e838e65490c8299f902a7731168/index_5.m3u8", programs: [] },
        { id: 4, name: "MBC 5", logo: "fas fa-tv", url: "https://mbc5-prod-dub-enc.edgenextcdn.net/out/v1/2720564b6a4641658fdfb6884b160da2/index_4.m3u8", programs: [] },
        { id: 5, name: "طاش ما طاش", logo: "fas fa-theater-masks", url: "https://shls-live-enc.edgenextcdn.net/out/v1/e34e3ac9d2534543a13b44c2b458b0c2/index_2.m3u8", programs: [] },
        { id: 6, name: "سيلفي", logo: "fas fa-laugh", url: "https://shls-live-enc.edgenextcdn.net/out/v1/2a0f4768f7fa42ed813674628b487e95/index_2.m3u8", programs: [] },
        { id: 7, name: "أفلام 2", logo: "fas fa-film", url: "https://shls-live-enc.edgenextcdn.net/out/v1/f6d718e841f8442f8374de47f18c93a7/index_2.m3u8", programs: [] },
        { id: 8, name: "أفلام عربي", logo: "fas fa-video", url: "https://shls-live-enc.edgenextcdn.net/out/v1/0044dd4b001a466c941ad77b04a574a2/index_2.m3u8", programs: [] },
        { id: 9, name: "مسرح مصر", logo: "fas fa-masks-theater", url: "https://shls-live-enc.edgenextcdn.net/out/v1/8fae48b64942450cb5d60b3fb6910de0/index_2.m3u8", programs: [] },

        // === قنوات MBC والعراقية ===
        { id: 10, name: "MBC عراق", logo: "fas fa-tv", url: "https://stream.veo.buzz:6056/enter/ch1/adaptive.m3u8", programs: [{ time: "18:00", title: "مسلسل مصري" }, { time: "21:00", title: "برنامج حواري" }] },
        { id: 11, name: "MBC 2", logo: "fas fa-newspaper", url: "https://stream.veo.buzz:6056/enter/ch2/adaptive.m3u8", programs: [{ time: "19:00", title: "النشرة الرئيسية" }, { time: "22:00", title: "تحليل اقتصادي" }] },
        { id: 12, name: "MBC 3", logo: "fas fa-tv", url: "https://stream.veo.buzz:6056/enter/ch3/adaptive.m3u8", programs: [] },
        { id: 13, name: "MBC 4", logo: "fas fa-tv", url: "https://stream.veo.buzz:6056/enter/ch4/adaptive.m3u8", programs: [] },
        { id: 14, name: "MBC A", logo: "fas fa-tv", url: "https://stream.veo.buzz:6056/enter/ch5/adaptive.m3u8", programs: [] },
        { id: 15, name: "MBC MAX", logo: "fas fa-tv", url: "https://stream.veo.buzz:6056/enter/ch6/adaptive.m3u8", programs: [] },
        { id: 16, name: "MBC دراما", logo: "fas fa-film", url: "https://stream.veo.buzz:6056/enter/ch7/adaptive.m3u8", programs: [] },
        { id: 17, name: "MBC بلس دراما", logo: "fas fa-star", url: "https://stream.veo.buzz:6056/enter/ch8/adaptive.m3u8", programs: [] },
        { id: 18, name: "MBC 1", logo: "fas fa-globe", url: "https://stream.veo.buzz:6056/enter/ch9/adaptive.m3u8", programs: [] },
        { id: 19, name: "MBC مصر 1", logo: "fas fa-globe", url: "https://stream.veo.buzz:6056/enter/ch10/adaptive.m3u8", programs: [] },
        { id: 20, name: "MBC مصر 2", logo: "fas fa-broadcast-tower", url: "https://stream.veo.buzz:6056/enter/ch11/adaptive.m3u8", programs: [] },
        { id: 21, name: "الشرقية", logo: "fas fa-bolt", url: "https://stream.veo.buzz:6056/enter/ch12/adaptive.m3u8", programs: [] },
        { id: 22, name: "دجلة", logo: "fas fa-video", url: "https://stream.veo.buzz:6056/enter/ch13/adaptive.m3u8", programs: [] },
        { id: 23, name: "UTV", logo: "fas fa-theater-masks", url: "https://stream.veo.buzz:6056/enter/ch14/adaptive.m3u8", programs: [] },
        { id: 24, name: "السومريه", logo: "fas fa-music", url: "https://stream.veo.buzz:6056/enter/ch15/adaptive.m3u8", programs: [] },
        { id: 25, name: "الرشيد", logo: "fas fa-city", url: "https://stream.veo.buzz:6056/enter/ch16/adaptive.m3u8", programs: [] },
        { id: 26, name: "قناة الرابعة", logo: "fas fa-flag", url: "https://stream.veo.buzz:6056/enter/ch17/adaptive.m3u8", programs: [] },

        // === القنوات الإسلامية ===
        { id: 27, name: "الأنوار", logo: "fas fa-moon", url: "https://stream.veo.buzz:6050/islamic/ch1/adaptive.m3u8", programs: [] },
        { id: 28, name: "كربلاء", logo: "fas fa-kaaba", url: "https://stream.veo.buzz:6050/islamic/ch2/adaptive.m3u8", programs: [] },
        { id: 29, name: "الفرات", logo: "fas fa-water", url: "https://stream.veo.buzz:6050/islamic/ch3/adaptive.m3u8", programs: [] },
        { id: 30, name: "الولاية", logo: "fas fa-pray", url: "https://stream.veo.buzz:6050/islamic/ch4/adaptive.m3u8", programs: [] },
        { id: 31, name: "القرآن الكريم", logo: "fas fa-book", url: "https://stream.veo.buzz:6050/islamic/ch5/adaptive.m3u8", programs: [] },
        { id: 32, name: "الجوادين", logo: "fas fa-mosque", url: "https://stream.veo.buzz:6050/islamic/ch6/adaptive.m3u8", programs: [] },
        { id: 33, name: "العقيلة", logo: "fas fa-star-and-crescent", url: "https://stream.veo.buzz:6050/islamic/ch8/adaptive.m3u8", programs: [] },
        { id: 34, name: "الحجة", logo: "fas fa-user-ninja", url: "https://stream.veo.buzz:6050/islamic/ch10/adaptive.m3u8", programs: [] },
        { id: 35, name: "الغدير", logo: "fas fa-lightbulb", url: "https://stream.veo.buzz:6050/islamic/ch11/adaptive.m3u8", programs: [] },
        { id: 36, name: "الشعائر", logo: "fas fa-burn", url: "https://stream.veo.buzz:6050/islamic/ch13/adaptive.m3u8", programs: [] },
        { id: 37, name: "أم البنين", logo: "fas fa-female", url: "https://stream.veo.buzz:6050/islamic/ch14/adaptive.m3u8", programs: [] },
        { id: 38, name: "الإمام علي", logo: "fas fa-heart", url: "https://stream.veo.buzz:6050/islamic/ch15/adaptive.m3u8", programs: [] }
      ],

      tod: [
        { id: 1, name: "TOD 1", logo: "fas fa-tv", url: "https://stream.veo.buzz:6072/sport/ch1/adaptive.m3u8", programs: [] },
        { id: 2, name: "TOD 2", logo: "fas fa-tv", url: "https://stream.veo.buzz:6072/sport/ch2/adaptive.m3u8", programs: [] },
        { id: 3, name: "TOD 3", logo: "fas fa-tv", url: "https://stream.veo.buzz:6072/sport/ch3/adaptive.m3u8", programs: [] },
        { id: 4, name: "TOD 4", logo: "fas fa-tv", url: "https://stream.veo.buzz:6072/sport/ch4/adaptive.m3u8", programs: [] },
        { id: 5, name: "TOD 5", logo: "fas fa-tv", url: "https://stream.veo.buzz:6072/sport/ch5/adaptive.m3u8", programs: [] },
        { id: 6, name: "TOD 6", logo: "fas fa-tv", url: "https://stream.veo.buzz:6072/sport/ch6/adaptive.m3u8", programs: [] },
        { id: 7, name: "TOD 7", logo: "fas fa-tv", url: "https://stream.veo.buzz:6072/sport/ch7/adaptive.m3u8", programs: [] },
        { id: 8, name: "TOD 8", logo: "fas fa-tv", url: "https://stream.veo.buzz:6072/sport/ch8/adaptive.m3u8", programs: [] },
        { id: 9, name: "TOD 9", logo: "fas fa-tv", url: "https://stream.veo.buzz:6072/sport/ch9/adaptive.m3u8", programs: [] },
        { id: 10, name: "TOD 10", logo: "fas fa-tv", url: "https://stream.veo.buzz:6072/sport/ch10/adaptive.m3u8", programs: [] }
      ],

      ssc: [
        { id: 1, name: "SSC 1", logo: "fas fa-trophy", url: "https://stream.veo.buzz:6072/sport/ch9/adaptive.m3u8", programs: [] },
        { id: 2, name: "SSC 2", logo: "fas fa-trophy", url: "https://stream.veo.buzz:6072/sport/ch15/adaptive.m3u8", programs: [] },
        { id: 3, name: "alkass قناة", logo: "fas fa-trophy", url: "https://stream.veo.buzz:6072/sport/ch16/adaptive.m3u8", programs: [] },
        { id: 4, name: "SSC شبكتي", logo: "fas fa-trophy", url: "http://stream.shabakaty.com:6010/sport/ch9/adaptive.m3u8", programs: [] },
        { id: 5, name: "SSC 2 شبكتي", logo: "fas fa-trophy", url: "http://stream.shabakaty.com:6010/sport/ch10/adaptive.m3u8", programs: [] }
      ],
      
      bein: [
        { id: 1, name: "Bein Sports 1", logo: "fas fa-futbol", url: "https://wo.cma.footballii.ir/hls2/b1_mid.m3u8", programs: [] },
        { id: 2, name: "Bein Sports 2", logo: "fas fa-futbol", url: "https://wo.cma.footballii.ir/hls2/b1_low.m3u8", programs: [] },
        { id: 3, name: "Bein Sports 1", logo: "fas fa-futbol", url: "https://abc.yallashooot.store/bein1/tracks-v1a1/mono.ts.m3u8", programs: [] },
        { id: 4, name: "Bein Sports 2", logo: "fas fa-futbol", url: "https://abc.yallashooot.store/bein2/index.m3u8", programs: [] },
        { id: 5, name: "Bein Sports 3", logo: "fas fa-futbol", url: "https://abc.yallashooot.store/bein3/index.m3u8", programs: [] },
        { id: 6, name: "Bein Sports 4", logo: "fas fa-futbol", url: "https://abc.yallashooot.store/bein4/index.m3u8", programs: [] },
        { id: 7, name: "شبكتي سبورت 1", logo: "fas fa-futbol", url: "http://stream.mytvplus.net:7002/sport/ch1/adaptive.m3u8", programs: [] },
        { id: 8, name: "شبكتي سبورت 2", logo: "fas fa-futbol", url: "http://stream.mytvplus.net:7003/sport/ch2/adaptive.m3u8", programs: [] },
        { id: 9, name: "شبكتي سبورت 3", logo: "fas fa-futbol", url: "http://stream.mytvplus.net:7004/sport/ch3/adaptive.m3u8", programs: [] },
        { id: 10, name: "شبكتي سبورت 4", logo: "fas fa-futbol", url: "http://stream.mytvplus.net:7005/sport/ch4/adaptive.m3u8", programs: [] },
        { id: 11, name: "شبكتي سبورت 5", logo: "fas fa-futbol", url: "http://stream.mytvplus.net:7006/sport/ch5/adaptive.m3u8", programs: [] },
        { id: 12, name: "شبكتي سبورت 6", logo: "fas fa-futbol", url: "http://stream.mytvplus.net:7007/sport/ch6/adaptive.m3u8", programs: [] },
        { id: 13, name: "شبكتي سبورت 7", logo: "fas fa-futbol", url: "http://stream.mytvplus.net:7008/sport/ch7/adaptive.m3u8", programs: [] },
        { id: 14, name: "شبكتي سبورت 8", logo: "fas fa-futbol", url: "http://stream.mytvplus.net:7009/sport/ch8/adaptive.m3u8", programs: [] },
        { id: 15, name: "شبكتي سبورت 9", logo: "fas fa-futbol", url: "http://stream.mytvplus.net:7010/sport/ch9/adaptive.m3u8", programs: [] },
        { id: 16, name: "شبكتي سبورت 10", logo: "fas fa-futbol", url: "http://stream.mytvplus.net:7011/sport/ch10/adaptive.m3u8", programs: [] }
      ],

      music: [
        { id: 1, name: "راديو بين سبورت احمد", logo: "fas fa-music", url: "https://stream-176.zeno.fm/qejhjl9xcrouv", programs: [{ time: "00:00", title: "تلاوة قرآنية" }, { time: "20:00", title: "مباشر" }] },
        { id: 2, name: "راديو بين سبورت 4k", logo: "fas fa-music", url: "https://2h.ae/anis-and-wafi-live1", programs: [{ time: "00:00", title: "تلاوة قرآنية" }, { time: "06:00", title: "أذكار الصباح" }] },
        { id: 3, name: "راديو بين سبورت حامد", logo: "fas fa-music", url: "https://radio.hamid-anisfm.com/stream/1/hamidfm2024", programs: [{ time: "00:00", title: "تلاوة قرآنية" }, { time: "21:00", title: "مباشر" }] },
        { id: 4, name: "بين سبورت 1", logo: "fas fa-music", url: "https://cdn.anisfm.pp.ua/listen/anis_fm/1M", programs: [{ time: "08:00", title: "أغاني عربية" }, { time: "19:00", title: "تعمل وقت المباريات المباشرة فقط" }] },
        { id: 5, name: "بين سبورت 2", logo: "fas fa-music", url: "https://cdn.anisfm.pp.ua/listen/anis_fm_2/2M", programs: [{ time: "08:00", title: "تعمل وقت المباريات المباشرة فقط" }, { time: "16:00", title: "تعمل وقت المباريات المباشرة فقط" }] },
        { id: 6, name: "بين سبورت 3", logo: "fas fa-music", url: "https://cdn.anisfm.pp.ua/listen/anis_fm_3/3M", programs: [{ time: "12:00", title: "تعمل وقت المباريات المباشرة فقط" }, { time: "21:00", title: "تعمل وقت المباريات المباشرة فقط" }] },
        { id: 7, name: "بين سبورت 4", logo: "fas fa-music", url: "https://cdn.anisfm.pp.ua/listen/anis_fm_4/4M", programs: [{ time: "08:00", title: "تعمل وقت المباريات المباشرة فقط" }, { time: "22:00", title: "تعمل وقت المباريات المباشرة فقط" }] }
      ]
    };

    // ========== نظام المفضلة ========== //
    let favorites = JSON.parse(localStorage.getItem('favorites')) || [];

    function toggleFavorite(channelId, category) {
      const index = favorites.findIndex(fav => fav.id === channelId && fav.category === category);
      
      if (index === -1) {
        const channel = channels[category].find(c => c.id === channelId);
        if (channel) {
          favorites.push({
            id: channelId,
            category: category,
            name: channel.name,
            logo: channel.logo,
            url: channel.url
          });
        }
      } else {
        favorites.splice(index, 1);
      }
      
      localStorage.setItem('favorites', JSON.stringify(favorites));
      updateFavoritesUI();
    }

    function isFavorite(channelId, category) {
      return favorites.some(fav => fav.id === channelId && fav.category === category);
    }

    function updateFavoritesUI() {
      const container = document.getElementById("favorites-channels");
      container.innerHTML = '';
      
      if (favorites.length === 0) {
        container.innerHTML = '<p style="grid-column: 1/-1; text-align: center;">لا توجد قنوات في المفضلة</p>';
        return;
      }
      
      favorites.forEach(fav => {
        container.innerHTML += `
          <div class="channel-btn ${fav.category}-btn" onclick="playChannel('${fav.category}', ${fav.id})">
            <button class="favorite-btn active" onclick="event.stopPropagation(); toggleFavorite(${fav.id}, '${fav.category}')">
              <i class="fas fa-heart"></i>
            </button>
            <i class="${fav.logo}"></i>
            ${fav.name}
          </div>
        `;
      });
    }

    // ========== تشغيل القنوات ========== //
    function playChannel(category, channelId) {
      let channel;
      
      if (category === 'favorites') {
        channel = favorites.find(fav => fav.id === channelId);
      } else {
        channel = channels[category].find(c => c.id === channelId);
      }
      
      if (!channel) return;
      
      currentChannel = { category, channelId };
      channelName.textContent = channel.name;
      
      // إذا كانت القناة الموسيقية
      if (category === 'music') {
        playMusic(channel.url, channelId);
        return;
      }
      
      if (channel.url) {
        loadStreamWithLoading(channel.url);
      }
      
      showProgramGuide(channelId, category);
    }

    function playMusic(url, channelId) {
      video.pause();
      playIcon.classList.replace("fa-pause", "fa-play");
      musicPlayer.pause();
      musicPlayer.src = url;
      musicPlayer.play().catch(e => console.error("خطأ في تشغيل الموسيقى:", e));
      
      // إخفاء دليل برامج الفيديو
      document.querySelectorAll('.program-guide:not(#music-program-guide)').forEach(guide => {
        guide.classList.remove('active');
      });
      
      showProgramGuide(channelId, 'music');
    }

    // ========== تحميل البث ========== //
    function loadStream(url) {
      if (hls) {
        hls.destroy();
        hls = null;
      }
      
      if (url.includes('.m3u8')) {
        if (Hls.isSupported()) {
          hls = new Hls({
            maxMaxBufferLength: 30,
            maxBufferSize: 60 * 1000 * 1000,
            maxBufferLength: 30,
            enableWorker: true,
            lowLatencyMode: true,
            backBufferLength: 30
          });
          
          hls.loadSource(url);
          hls.attachMedia(video);
          
          hls.on(Hls.Events.MANIFEST_PARSED, function(event, data) {
            updateQualityOptions(data.levels);
            video.play().catch(e => {
              console.error("فشل التشغيل التلقائي:", e);
              loadingOverlay.style.display = "none";
            });
            playIcon.classList.replace("fa-play", "fa-pause");
          });
          
          hls.on(Hls.Events.ERROR, function(event, data) {
            console.error("حدث خطأ في HLS:", data);
            if (data.fatal) {
              handleStreamError(data);
            }
          });
          
          hls.on(Hls.Events.LEVEL_SWITCHED, function(event, data) {
            updateQualityIndicator(data.level);
          });
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
          video.src = url;
          video.addEventListener('loadedmetadata', function() {
            video.play().catch(e => {
              console.error("فشل التشغيل التلقائي:", e);
              loadingOverlay.style.display = "none";
            });
            playIcon.classList.replace("fa-play", "fa-pause");
          });
        } else {
          showError("المتصفح لا يدعم تشغيل هذا النوع من البث");
        }
      } else {
        video.src = url;
        video.play().catch(e => {
          console.error("فشل التشغيل التلقائي:", e);
          loadingOverlay.style.display = "none";
        });
        playIcon.classList.replace("fa-play", "fa-pause");
      }
    }

    function updateQualityOptions(levels) {
      if (!levels || levels.length < 2) return;
      
      const qualityMenu = document.getElementById('qualityMenu');
      qualityMenu.innerHTML = '';
      
      // إضافة خيار التلقائي أولاً
      qualityMenu.innerHTML += `<button onclick="changeQuality('auto')" class="${currentQuality === 'auto' ? 'active' : ''}">تلقائي</button>`;
      
      // إضافة خيارات الجودة حسب المستويات المتاحة
      levels.forEach((level, index) => {
        const height = level.height;
        let qualityText;
        
        if (height <= 240) qualityText = '240p';
        else if (height <= 360) qualityText = '360p';
        else if (height <= 480) qualityText = '480p';
        else if (height <= 720) qualityText = '720p';
        else if (height <= 1080) qualityText = '1080p';
        else qualityText = `${height}p`;
        
        qualityMenu.innerHTML += `
          <button onclick="changeQuality(${index})" class="${currentQuality === index.toString() ? 'active' : ''}">
            جودة ${qualityText}
          </button>
        `;
      });
    }

    function updateQualityIndicator(levelIndex) {
      if (!hls || !hls.levels || levelIndex === undefined) return;
      
      const level = hls.levels[levelIndex];
      if (!level) return;
      
      const height = level.height;
      let qualityText;
      
      if (height <= 240) qualityText = '240p';
      else if (height <= 360) qualityText = '360p';
      else if (height <= 480) qualityText = '480p';
      else if (height <= 720) qualityText = '720p';
      else if (height <= 1080) qualityText = '1080p';
      else qualityText = `${height}p`;
      
      qualityIndicator.textContent = `جودة: ${qualityText}`;
    }

    function handleStreamError(error) {
      console.error("خطأ في البث:", error);
      loadingOverlay.style.display = "none";
      
      let errorMsg = "حدث خطأ في تحميل البث";
      if (error.type === Hls.ErrorTypes.NETWORK_ERROR) {
        errorMsg = "خطأ في الشبكة، يرجى التحقق من اتصال الإنترنت";
      } else if (error.type === Hls.ErrorTypes.MEDIA_ERROR) {
        errorMsg = "خطأ في تشغيل الفيديو";
      }
      
      showError(errorMsg);
      
      // إعادة المحاولة إذا كان الخطأ غير مميت أو لم نتجاوز الحد الأقصى للمحاولات
      if (retryCount < MAX_RETRIES && (!error.fatal || error.type === Hls.ErrorTypes.NETWORK_ERROR)) {
        retryCount++;
        setTimeout(() => {
          showError(`${errorMsg} - إعادة المحاولة (${retryCount}/${MAX_RETRIES})`);
          if (currentChannel) {
            playChannel(currentChannel.category, currentChannel.channelId);
          }
        }, 3000);
      } else {
        retryCount = 0;
      }
    }

    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.style.display = "block";
      loadingOverlay.style.display = "flex";
    }

    function loadStreamWithLoading(url) {
      retryCount = 0;
      errorMessage.style.display = "none";
      loadingOverlay.style.display = "flex";
      video.pause();
      video.src = '';
      
      setTimeout(() => {
        loadStream(url);
      }, 100);
     
      video.oncanplay = () => {
        loadingOverlay.style.display = "none";
        updateTimeDisplay();
        video.oncanplay = null;
        video.onerror = null;
      };
      
      video.onerror = () => {
        loadingOverlay.style.display = "none";
        showError("حدث خطأ في تشغيل الفيديو");
      };
    }

    // ========== عناصر التحكم ========== //
    function togglePlay() {
      if (video.paused) {
        video.play().catch(e => console.error("فشل التشغيل:", e));
        playIcon.classList.replace("fa-play", "fa-pause");
      } else {
        video.pause();
        playIcon.classList.replace("fa-pause", "fa-play");
      }
    }

    function stopVideo() {
      video.pause();
      video.currentTime = 0;
      playIcon.classList.replace("fa-pause", "fa-play");
    }

    function toggleMute() {
      video.muted = !video.muted;
      volumeIcon.className = video.muted ? "fas fa-volume-mute" : "fas fa-volume-up";
    }

    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        playerContainer.requestFullscreen?.().catch(e => console.error("فشل الدخول إلى وضع ملء الشاشة:", e));
      } else {
        document.exitFullscreen?.().catch(e => console.error("فشل الخروج من وضع ملء الشاشة:", e));
      }
    }

    function togglePlayerSize() {
      isExpanded = !isExpanded;
      playerContainer.classList.toggle('expanded', isExpanded);
    }

    function toggleQualityMenu(event) {
      event.stopPropagation();
      qualityMenu.style.display = qualityMenu.style.display === "block" ? "none" : "block";
    }

    function changeQuality(quality) {
      currentQuality = quality;
      qualityMenu.style.display = "none";
      
      if (hls) {
        if (quality === 'auto') {
          hls.currentLevel = -1; // وضع تلقائي
        } else {
          hls.currentLevel = parseInt(quality);
        }
      }
      
      if (currentChannel) {
        playChannel(currentChannel.category, currentChannel.channelId);
      }
    }

    function seek(event) {
      if (!isSeeking) {
        const rect = progress.parentElement.getBoundingClientRect();
        const pos = (event.clientX - rect.left) / rect.width;
        video.currentTime = pos * video.duration;
      }
    }

    function updateTimeDisplay() {
      if (isSeeking) return;
      
      const currentTime = formatTime(video.currentTime);
      const duration = formatTime(video.duration);
      
      currentTimeDisplay.textContent = currentTime;
      durationDisplay.textContent = duration;
      progress.style.width = (video.currentTime / video.duration) * 100 + '%';
    }

    function formatTime(seconds) {
      const minutes = Math.floor(seconds / 60);
      seconds = Math.floor(seconds % 60);
      return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    // إغلاق قائمة الجودة عند النقر خارجها
    document.addEventListener('click', function(event) {
      if (!qualityMenu.contains(event.target) && event.target !== qualityBtn) {
        qualityMenu.style.display = "none";
      }
    });

    // ========== إدارة البرامج ========== //
    function showProgramGuide(channelId, category) {
      let channel;
      
      if (category === 'favorites') {
        channel = favorites.find(fav => fav.id === channelId && fav.category === category);
      } else {
        channel = channels[category].find(c => c.id === channelId);
      }
      
      if (!channel) return;
      
      const guideId = `${category}-program-guide`;
      const guide = document.getElementById(guideId);
      
      if (!guide || !channel.programs || channel.programs.length === 0) {
        if (guide) guide.classList.remove("active");
        return;
      }
      
      const programList = guide.querySelector("div");
      programList.innerHTML = channel.programs.map(program => `
        <div class="program-item">
          <span class="program-time">${program.time}</span>
          <span class="program-title">${program.title}</span>
        </div>
      `).join('');
      
      guide.classList.add("active");
    }

    // ========== عرض الأقسام ========== //
    function showChannelTab(tabId) {
      // إخفاء جميع المحتويات
      document.querySelectorAll('.channel-content').forEach(content => {
        content.classList.remove('active');
      });
      
      // إزالة التنشيط من جميع الألسنة
      document.querySelectorAll('.channel-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // عرض المحتوى المحدد وتنشيط اللسان
      document.getElementById(`${tabId}-content`).classList.add('active');
      event.currentTarget.classList.add('active');
      
      // تشغيل أول قناة في القسم تلقائياً
      if (tabId === 'favorites') {
        if (favorites.length > 0) {
          playChannel('favorites', favorites[0].id);
        }
      } else if (channels[tabId]?.length > 0) {
        playChannel(tabId, channels[tabId][0].id);
      }
    }

    // ========== تهيئة واجهة القنوات ========== //
    function initChannelsUI() {
      // قسم Nilesat
      const nilesatContainer = document.getElementById("nilesat-channels");
      nilesatContainer.innerHTML = channels.nilesat.map(channel => `
        <div class="channel-btn nilesat-btn" onclick="playChannel('nilesat', ${channel.id})">
          <button class="favorite-btn ${isFavorite(channel.id, 'nilesat') ? 'active' : ''}" 
                  onclick="event.stopPropagation(); toggleFavorite(${channel.id}, 'nilesat')">
            <i class="${isFavorite(channel.id, 'nilesat') ? 'fas' : 'far'} fa-heart"></i>
          </button>
          <i class="${channel.logo}"></i>
          ${channel.name}
        </div>
      `).join('');

      // قسم Bein Sports
      const beinContainer = document.getElementById("bein-channels");
      beinContainer.innerHTML = channels.bein.map(channel => `
        <div class="channel-btn bein-btn" onclick="playChannel('bein', ${channel.id})">
          <button class="favorite-btn ${isFavorite(channel.id, 'bein') ? 'active' : ''}" 
                  onclick="event.stopPropagation(); toggleFavorite(${channel.id}, 'bein')">
            <i class="${isFavorite(channel.id, 'bein') ? 'fas' : 'far'} fa-heart"></i>
          </button>
          <i class="${channel.logo}"></i>
          ${channel.name}
        </div>
      `).join('');

      // قسم الموسيقى
      const musicContainer = document.getElementById("music-channels");
      musicContainer.innerHTML = channels.music.map(channel => `
        <div class="channel-btn music-btn" onclick="playChannel('music', ${channel.id})">
          <button class="favorite-btn ${isFavorite(channel.id, 'music') ? 'active' : ''}" 
                  onclick="event.stopPropagation(); toggleFavorite(${channel.id}, 'music')">
            <i class="${isFavorite(channel.id, 'music') ? 'fas' : 'far'} fa-heart"></i>
          </button>
          <i class="${channel.logo}"></i>
          ${channel.name}
        </div>
      `).join('');

      // قسم TOD
      const todContainer = document.getElementById("tod-channels");
      todContainer.innerHTML = channels.tod.map(channel => `
        <div class="channel-btn tod-btn" onclick="playChannel('tod', ${channel.id})">
          <button class="favorite-btn ${isFavorite(channel.id, 'tod') ? 'active' : ''}" 
                  onclick="event.stopPropagation(); toggleFavorite(${channel.id}, 'tod')">
            <i class="${isFavorite(channel.id, 'tod') ? 'fas' : 'far'} fa-heart"></i>
          </button>
          <i class="${channel.logo}"></i>
          ${channel.name}
        </div>
      `).join('');

      // قسم SSC
      const sscContainer = document.getElementById("ssc-channels");
      sscContainer.innerHTML = channels.ssc.map(channel => `
        <div class="channel-btn ssc-btn" onclick="playChannel('ssc', ${channel.id})">
          <button class="favorite-btn ${isFavorite(channel.id, 'ssc') ? 'active' : ''}" 
                  onclick="event.stopPropagation(); toggleFavorite(${channel.id}, 'ssc')">
            <i class="${isFavorite(channel.id, 'ssc') ? 'fas' : 'far'} fa-heart"></i>
          </button>
          <i class="${channel.logo}"></i>
          ${channel.name}
        </div>
      `).join('');

      updateFavoritesUI();
    }

    // ========== تهيئة الصفحة ========== //
    window.onload = function() {
      initChannelsUI();
      
      if (channels.nilesat.length > 0) {
        playChannel('nilesat', channels.nilesat[0].id);
      }
      
      video.ontimeupdate = updateTimeDisplay;
      progress.parentElement.onmousedown = () => isSeeking = true;
      document.onmouseup = () => isSeeking = false;
      document.onmousemove = (e) => {
        if (isSeeking) {
          seek(e);
        }
      };
      
      video.onclick = togglePlay;
      video.onplay = () => playIcon.classList.replace("fa-play", "fa-pause");
      video.onpause = () => playIcon.classList.replace("fa-pause", "fa-play");
      
      document.onkeydown = function(e) {
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
        
        switch(e.key) {
          case " ": e.preventDefault(); togglePlay(); break;
          case "ArrowRight": video.currentTime += 5; break;
          case "ArrowLeft": video.currentTime -= 5; break;
          case "ArrowUp": video.volume = Math.min(video.volume + 0.1, 1); break;
          case "ArrowDown": video.volume = Math.max(video.volume - 0.1, 0); break;
          case "f": toggleFullscreen(); break;
          case "m": toggleMute(); break;
          case "Escape": 
            if (document.fullscreenElement) {
              document.exitFullscreen();
            } else if (isExpanded) {
              togglePlayerSize();
            }
            break;
        }
      };
    };
  </script>
</body>
</html>